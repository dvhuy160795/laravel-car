/*
 * jQuery contextMenu - Plugin for simple contextMenu handling
 *
 * Version: 1.5.9
 *
 * Authors: Rodney Rehm, Addy Osmani (patches for FF)
 * Web: http://medialize.github.com/jQuery-contextMenu/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *   GPL v3 http://opensource.org/licenses/GPL-3.0
 *
 */
!function(e,t){function n(e){for(var t,n=e.split(/\s+/),a=[],o=0;t=n[o];o++)t=t[0].toUpperCase(),a.push(t);return a}function a(t){return t.id&&e('label[for="'+t.id+'"]').val()||t.name}function o(n,s,c){c||(c=0),s.each(function(){var s,i,l=e(this),r=this,u=this.nodeName.toLowerCase();switch("label"==u&&l.find("input, textarea, select").length&&(s=l.text(),u=(r=(l=l.children().first()).get(0)).nodeName.toLowerCase()),u){case"menu":o((i={name:l.attr("label"),items:{}}).items,l.children(),c);break;case"a":case"button":i={name:l.text(),disabled:!!l.attr("disabled"),callback:function(){l.click()}};break;case"menuitem":case"command":switch(l.attr("type")){case t:case"command":case"menuitem":i={name:l.attr("label"),disabled:!!l.attr("disabled"),callback:function(){l.click()}};break;case"checkbox":i={type:"checkbox",disabled:!!l.attr("disabled"),name:l.attr("label"),selected:!!l.attr("checked")};break;case"radio":i={type:"radio",disabled:!!l.attr("disabled"),name:l.attr("label"),radio:l.attr("radiogroup"),value:l.attr("id"),selected:!!l.attr("checked")};break;default:i=t}break;case"hr":i="-------";break;case"input":switch(l.attr("type")){case"text":i={type:"text",name:s||a(r),disabled:!!l.attr("disabled"),value:l.val()};break;case"checkbox":i={type:"checkbox",name:s||a(r),disabled:!!l.attr("disabled"),selected:!!l.attr("checked")};break;case"radio":i={type:"radio",name:s||a(r),disabled:!!l.attr("disabled"),radio:!!l.attr("name"),value:l.val(),selected:!!l.attr("checked")};break;default:i=t}break;case"select":i={type:"select",name:s||a(r),disabled:!!l.attr("disabled"),selected:l.val(),options:{}},l.children().each(function(){i.options[this.value]=e(this).text()});break;case"textarea":i={type:"textarea",name:s||a(r),disabled:!!l.attr("disabled"),value:l.val()};break;case"label":break;default:i={type:"html",html:l.clone(!0)}}i&&(n["key"+ ++c]=i)})}e.support.htmlMenuitem="HTMLMenuItemElement"in window,e.support.htmlCommand="HTMLCommandElement"in window;var s=null,c=!1,i=!1,l=e(window),r=0,u={},d={},m={},p={selector:null,appendTo:null,trigger:"right",autoHide:!1,ignoreRightClick:!1,delay:200,determinePosition:function(t){if(e.ui&&e.ui.position)t.css("display","block").position({my:"center top",at:"center bottom",of:this,offset:"0 5",collision:"fit"}).css("display","none");else{var n=this.offset();n.top+=this.outerHeight(),n.left+=this.outerWidth()/2-t.outerWidth()/2,t.css(n)}},position:function(t,n,a){var o;if(n||a){"maintain"===n&&"maintain"===a?o=t.$menu.position():(t.$trigger.parents().andSelf().filter(function(){return"fixed"==e(this).css("position")}).length&&(a-=l.scrollTop(),n-=l.scrollLeft()),o={top:a,left:n});var s=l.scrollTop()+l.height(),c=l.scrollLeft()+l.width(),i=t.$menu.height(),r=t.$menu.width();o.top+i>s&&(o.top-=i),o.left+r>c&&(o.left-=r),t.$menu.css(o)}else t.determinePosition.call(this,t.$menu)},positionSubmenu:function(t){if(e.ui&&e.ui.position)t.css("display","block").position({my:"left top",at:"right top",of:this,collision:"fit"}).css("display","");else{var n=this.offset();n.top+=0,n.left+=this.outerWidth(),t.css(n)}},zIndex:1,animation:{duration:50,show:"slideDown",hide:"slideUp"},events:{show:e.noop,hide:e.noop},callback:null,items:{}},h={timer:null,pageX:null,pageY:null},f=function(e){for(var t=0,n=e;;)if(t=Math.max(t,parseInt(n.css("z-index"),10)||0),!(n=n.parent())||!n.length||"body"==n.prop("nodeName").toLowerCase())break;return t},x={abortevent:function(e){e.preventDefault(),e.stopImmediatePropagation()},contextmenu:function(t){var n=e(this);if(t.preventDefault(),t.stopImmediatePropagation(),i)i=!1;else if(!n.hasClass("context-menu-disabled")){if(s=n,t.data.build){var a=t.data.build(s,t);if(!1===a)return;if(e.extend(!0,t.data,p,a||{}),!t.data.items||e.isEmptyObject(t.data.items))throw window.console&&(console.error||console.log)("No items specified to show in contextMenu"),new Error("No Items sepcified");g.create(t.data)}g.show.call(n,t.data,t.pageX,t.pageY)}},click:function(t){t.preventDefault(),t.stopImmediatePropagation(),e(this).trigger(jQuery.Event("contextmenu",{data:t.data,pageX:t.pageX,pageY:t.pageY}))},mousedown:function(t){var n=e(this);s&&s.length&&!s.is(n)&&s.data("contextMenu").$menu.trigger("contextmenu:hide"),2==t.button&&(s=n.data("contextMenuActive",!0))},mouseup:function(t){var n=e(this);n.data("contextMenuActive")&&s&&s.length&&s.is(n)&&!n.hasClass("context-menu-disabled")&&(t.preventDefault(),t.stopImmediatePropagation(),s=n,n.trigger(jQuery.Event("contextmenu",{data:t.data,pageX:t.pageX,pageY:t.pageY}))),n.removeData("contextMenuActive")},mouseenter:function(t){var n=e(this),a=e(t.relatedTarget),o=e(document);a.is(".context-menu-list")||a.closest(".context-menu-list").length||s&&s.length||(h.pageX=t.pageX,h.pageY=t.pageY,h.data=t.data,o.on("mousemove.contextMenuShow",x.mousemove),h.timer=setTimeout(function(){h.timer=null,o.off("mousemove.contextMenuShow"),s=n,n.trigger(jQuery.Event("contextmenu",{data:h.data,pageX:h.pageX,pageY:h.pageY}))},t.data.delay))},mousemove:function(e){h.pageX=e.pageX,h.pageY=e.pageY},mouseleave:function(t){var n=e(t.relatedTarget);if(!n.is(".context-menu-list")&&!n.closest(".context-menu-list").length){try{clearTimeout(h.timer)}catch(t){}h.timer=null}},ignoreRightClick:function(e){2==e.button&&(i=!0)},layerClick:function(t){var n=e(this),a=n.data("contextMenuRoot");t.preventDefault(),t.stopImmediatePropagation(),n.remove(),a.$menu.trigger("contextmenu:hide")},keyStop:function(e,t){try{t.isInput||e.preventDefault(),e.stopPropagation()}catch(e){}},key:function(e){if(s)try{var t=s.data("contextMenu");t&&($children=t.$menu.children(),$round)}catch(e){}switch(e.keyCode){case 9:case 38:if(x.keyStop(e,t),t.isInput){if(9==e.keyCode&&e.shiftKey)return e.preventDefault(),t.$selected&&t.$selected.find("input, textarea, select").blur(),void t.$menu.trigger("prevcommand");if(38==e.keyCode&&"checkbox"==t.$selected.find("input, textarea, select").prop("type"))return void e.preventDefault()}else if(9!=e.keyCode||e.shiftKey)return void(t&&t.$menu&&t.$menu.trigger&&t.$menu.trigger("prevcommand"));case 9:case 40:if(x.keyStop(e,t),!t.isInput)return void t.$menu.trigger("nextcommand");if(9==e.keyCode)return e.preventDefault(),t.$selected&&t.$selected.find("input, textarea, select").blur(),void t.$menu.trigger("nextcommand");if(40==e.keyCode&&"checkbox"==t.$selected.find("input, textarea, select").prop("type"))return void e.preventDefault();break;case 37:if(x.keyStop(e,t),t.isInput||!t.$selected||!t.$selected.length)break;if(!t.$selected.parent().hasClass("context-menu-root")){var n=t.$selected.parent().parent();return t.$selected.trigger("contextmenu:blur"),void(t.$selected=n)}break;case 39:if(x.keyStop(e,t),t.isInput||!t.$selected||!t.$selected.length)break;var a=t.$selected.data("contextMenu")||{};if(a.$menu&&t.$selected.hasClass("context-menu-submenu"))return t.$selected=null,a.$selected=null,void a.$menu.trigger("nextcommand");break;case 35:case 36:return t.$selected&&t.$selected.find("input, textarea, select").length?void 0:((t.$selected&&t.$selected.parent()||t.$menu).children(":not(.disabled, .not-selectable)")[36==e.keyCode?"first":"last"]().trigger("contextmenu:focus"),void e.preventDefault());case 13:if(x.keyStop(e,t),t.isInput){if(t.$selected&&!t.$selected.is("textarea, select"))return void e.preventDefault();break}return void(t.$selected&&t.$selected.trigger("mouseup"));case 32:case 33:case 34:return void x.keyStop(e,t);case 27:return x.keyStop(e,t),void t.$menu.trigger("contextmenu:hide");default:var o=String.fromCharCode(e.keyCode).toUpperCase();if(t&&t.accesskeys[o])return void t.accesskeys[o].$node.trigger(t.accesskeys[o].$menu?"contextmenu:focus":"mouseup")}e.stopPropagation(),t&&t.$selected&&t.$selected.trigger(e)},prevItem:function(t){t.stopPropagation();var n=e(this).data("contextMenu")||{};if(n.$selected){var a=n.$selected;(n=n.$selected.parent().data("contextMenu")||{}).$selected=a}for(var o=n.$menu.children(),s=n.$selected&&n.$selected.prev().length?n.$selected.prev():o.last(),c=s;s.hasClass("disabled")||s.hasClass("not-selectable");)if((s=s.prev().length?s.prev():o.last()).is(c))return;n.$selected&&x.itemMouseleave.call(n.$selected.get(0),t),x.itemMouseenter.call(s.get(0),t);var i=s.find("input, textarea, select");i.length&&i.focus()},nextItem:function(t){t.stopPropagation();var n=e(this).data("contextMenu")||{};if(n.$selected){var a=n.$selected;(n=n.$selected.parent().data("contextMenu")||{}).$selected=a}for(var o=n.$menu.children(),s=n.$selected&&n.$selected.next().length?n.$selected.next():o.first(),c=s;s.hasClass("disabled")||s.hasClass("not-selectable");)if((s=s.next().length?s.next():o.first()).is(c))return;n.$selected&&x.itemMouseleave.call(n.$selected.get(0),t),x.itemMouseenter.call(s.get(0),t);var i=s.find("input, textarea, select");i.length&&i.focus()},focusInput:function(t){var n=e(this).closest(".context-menu-item"),a=n.data(),o=a.contextMenu,s=a.contextMenuRoot;s.$selected=o.$selected=n,s.isInput=o.isInput=!0},blurInput:function(t){var n=e(this).closest(".context-menu-item").data(),a=n.contextMenu;n.contextMenuRoot.isInput=a.isInput=!1},menuMouseenter:function(t){e(this).data().contextMenuRoot.hovering=!0},menuMouseleave:function(t){var n=e(this).data().contextMenuRoot;n.$layer&&n.$layer.is(t.relatedTarget)&&(n.hovering=!1)},itemMouseenter:function(t){var n=e(this),a=n.data(),o=a.contextMenu,s=a.contextMenuRoot;s.hovering=!0,t&&s.$layer&&s.$layer.is(t.relatedTarget)&&(t.preventDefault(),t.stopImmediatePropagation()),(o.$menu?o:s).$menu.children(".hover").trigger("contextmenu:blur"),n.hasClass("disabled")||n.hasClass("not-selectable")?o.$selected=null:n.trigger("contextmenu:focus")},itemMouseleave:function(t){var n=e(this),a=n.data(),o=a.contextMenu,s=a.contextMenuRoot;if(s!==o&&s.$layer&&s.$layer.is(t.relatedTarget))return s.$selected&&s.$selected.trigger("contextmenu:blur"),t.preventDefault(),t.stopImmediatePropagation(),void(s.$selected=o.$selected=o.$node);n.trigger("contextmenu:blur")},itemClick:function(t){var n,a=e(this),o=a.data(),s=o.contextMenu,c=o.contextMenuRoot,i=o.contextMenuKey;if(s.items[i]&&!a.hasClass("disabled")){if(t.preventDefault(),t.stopImmediatePropagation(),e.isFunction(c.callbacks[i]))n=c.callbacks[i];else{if(!e.isFunction(c.callback))return;n=c.callback}!1!==n.call(c.$trigger,i,c)?c.$menu.trigger("contextmenu:hide"):g.update.call(c.$trigger,c)}},inputClick:function(e){e.stopImmediatePropagation()},hideMenu:function(t){var n=e(this).data("contextMenuRoot");g.hide.call(n.$trigger,n)},focusItem:function(t){t.stopPropagation();var n=e(this),a=n.data(),o=a.contextMenu,s=a.contextMenuRoot;n.addClass("hover").siblings(".hover").trigger("contextmenu:blur"),o.$selected=s.$selected=n,o.$node&&s.positionSubmenu.call(o.$node,o.$menu)},blurItem:function(t){t.stopPropagation();var n=e(this),a=n.data(),o=a.contextMenu;a.contextMenuRoot;n.removeClass("hover"),o.$selected=null}},g={show:function(t,n,a){var o=e(this),c={};if(e("#context-menu-layer").trigger("mousedown"),!1!==t.events.show.call(o,t)){if(t.$trigger=o,g.update.call(o,t),t.position.call(o,t,n,a),t.zIndex&&(c.zIndex=f(o)+t.zIndex),g.layer.call(t.$menu,t,c.zIndex),t.$menu.find("ul").css("zIndex",c.zIndex+1),t.$menu.css(c)[t.animation.show](t.animation.duration),o.data("contextMenu",t),e(document).off("keydown.contextMenu").on("keydown.contextMenu",x.key),t.autoHide){var i=o.position();i.right=i.left+o.outerWidth(),i.bottom=i.top+this.outerHeight(),e(document).on("mousemove.contextMenuAutoHide",function(e){!t.$layer||t.hovering||e.pageX>=i.left&&e.pageX<=i.right&&e.pageY>=i.top&&e.pageY<=i.bottom||t.$layer.trigger("mousedown")})}}else s=null},hide:function(n){var a=e(this);if(n||(n=a.data("contextMenu")||{}),!n.events||!1!==n.events.hide.call(a,n)){if(n.$layer)try{n.$layer.remove(),delete n.$layer}catch(e){n.$layer=null}s=null,n.$menu.find(".hover").trigger("contextmenu:blur"),n.$selected=null,e(document).off(".contextMenuAutoHide").off("keydown.contextMenu"),n.$menu&&n.$menu[n.animation.hide](n.animation.duration),n.build&&(n.$menu.remove(),e.each(n,function(e,a){switch(e){case"ns":case"selector":case"build":case"trigger":case"ignoreRightClick":return!0;default:n[e]=t;try{delete n[e]}catch(e){}return!0}}))}},create:function(a,o){o===t&&(o=a),a.$menu=e('<ul class="context-menu-list '+(a.className||"")+'"></ul>').data({contextMenu:a,contextMenuRoot:o}),e.each(["callbacks","commands","inputs"],function(e,t){a[t]={},o[t]||(o[t]={})}),o.accesskeys||(o.accesskeys={}),e.each(a.items,function(t,s){var c=e('<li class="context-menu-item '+(s.className||"")+'"></li>'),i=null,l=null;if(s.$node=c.data({contextMenu:a,contextMenuRoot:o,contextMenuKey:t}),s.accesskey)for(var r,u=n(s.accesskey),d=0;r=u[d];d++)if(!o.accesskeys[r]){o.accesskeys[r]=s,s._name=s.name.replace(new RegExp("("+r+")","i"),'<span class="context-menu-accesskey">$1</span>');break}if("string"==typeof s)c.addClass("context-menu-separator not-selectable");else if(s.type&&m[s.type])m[s.type].call(c,s,a,o),e.each([a,o],function(n,a){a.commands[t]=s,e.isFunction(s.callback)&&(a.callbacks[t]=s.callback)});else{switch("html"==s.type?c.addClass("context-menu-html not-selectable"):s.type?(i=e("<label></label>").appendTo(c),e("<span></span>").html(s._name||s.name).appendTo(i),c.addClass("context-menu-input"),a.hasTypes=!0,e.each([a,o],function(e,n){n.commands[t]=s,n.inputs[t]=s})):s.items&&(s.type="sub"),s.type){case"text":l=e('<input type="text" value="1" name="context-menu-input-'+t+'" value="">').val(s.value||"").appendTo(i);break;case"textarea":l=e('<textarea name="context-menu-input-'+t+'"></textarea>').val(s.value||"").appendTo(i),s.height&&l.height(s.height);break;case"checkbox":l=e('<input type="checkbox" value="1" name="context-menu-input-'+t+'" value="">').val(s.value||"").prop("checked",!!s.selected).prependTo(i);break;case"radio":l=e('<input type="radio" value="1" name="context-menu-input-'+s.radio+'" value="">').val(s.value||"").prop("checked",!!s.selected).prependTo(i);break;case"select":l=e('<select name="context-menu-input-'+t+'">').appendTo(i),s.options&&(e.each(s.options,function(t,n){e("<option></option>").val(t).text(n).appendTo(l)}),l.val(s.selected));break;case"sub":e("<span></span>").html(s._name||s.name).appendTo(c),s.appendTo=s.$node,g.create(s,o),c.data("contextMenu",s).addClass("context-menu-submenu"),s.callback=null;break;case"html":e(s.html).appendTo(c);break;default:e.each([a,o],function(n,a){a.commands[t]=s,e.isFunction(s.callback)&&(a.callbacks[t]=s.callback)}),e("<span></span>").html(s._name||s.name||"").appendTo(c)}s.type&&"sub"!=s.type&&"html"!=s.type&&(l.on("focus",x.focusInput).on("blur",x.blurInput),s.events&&l.on(s.events)),s.icon&&c.addClass("icon icon-"+s.icon)}s.$input=l,s.$label=i,c.appendTo(a.$menu),a.hasTypes||(e.browser.msie?c.on("selectstart.disableTextSelect",x.abortevent):e.browser.mozilla||c.on("mousedown.disableTextSelect",x.abortevent))}),a.$node||a.$menu.css("display","none").addClass("context-menu-root"),a.$menu.appendTo(a.appendTo||document.body)},update:function(n,a){var o=this;a===t&&(a=n,n.$menu.find("ul").andSelf().css({position:"static",display:"block"}).each(function(){var t=e(this);t.width(t.css("position","absolute").width()).css("position","static")}).css({position:"",display:""})),n.$menu.children().each(function(){var t=e(this),s=t.data("contextMenuKey"),c=n.items[s],i=e.isFunction(c.disabled)&&c.disabled.call(o,s,a)||!0===c.disabled;if(t[i?"addClass":"removeClass"]("disabled"),c.type)switch(t.find("input, select, textarea").prop("disabled",i),c.type){case"text":case"textarea":c.$input.val(c.value||"");break;case"checkbox":case"radio":c.$input.val(c.value||"").prop("checked",!!c.selected);break;case"select":c.$input.val(c.selected||"")}c.$menu&&g.update.call(o,c,a)})},layer:function(t,n){var a=t.$layer=e('<div id="context-menu-layer" style="position:fixed; z-index:'+n+'; top:0; left:0; opacity: 0; filter: alpha(opacity=0); background-color: #000;"></div>').css({height:l.height(),width:l.width(),display:"block"}).data("contextMenuRoot",t).insertBefore(this).on("contextmenu",x.abortevent).on("mousedown",x.layerClick);return e.support.fixedPosition||a.css({position:"absolute",height:e(document).height()}),a}};e.fn.contextMenu=function(e){try{if(e===t)this.first().trigger("contextmenu");else if(e.x&&e.y)this.first().trigger(jQuery.Event("contextmenu",{pageX:e.x,pageY:e.y}));else if("hide"===e){var n=this.data("contextMenu").$menu;n&&n.trigger("contextmenu:hide")}else e?this.removeClass("context-menu-disabled"):e||this.addClass("context-menu-disabled")}catch(e){}return this},e.contextMenu=function(n,a){"string"!=typeof n&&(a=n,n="create"),"string"==typeof a?a={selector:a}:a===t&&(a={});var o=e.extend(!0,{},p,a||{}),s=s=e(document);switch(n){case"create":if(!o.selector)throw new Error("No selector specified");if(o.selector.match(/.context-menu-(list|item|input)($|\s)/))throw new Error('Cannot bind to selector "'+o.selector+'" as it contains a reserved className');if(!o.build&&(!o.items||e.isEmptyObject(o.items)))throw new Error("No Items sepcified");switch(r++,o.ns=".contextMenu"+r,u[o.selector]=o.ns,d[o.ns]=o,c||(s.on({"contextmenu:hide.contextMenu":x.hideMenu,"prevcommand.contextMenu":x.prevItem,"nextcommand.contextMenu":x.nextItem,"contextmenu.contextMenu":x.abortevent,"mouseenter.contextMenu":x.menuMouseenter,"mouseleave.contextMenu":x.menuMouseleave},".context-menu-list").on("mouseup.contextMenu",".context-menu-input",x.inputClick).on({"mouseup.contextMenu":x.itemClick,"contextmenu:focus.contextMenu":x.focusItem,"contextmenu:blur.contextMenu":x.blurItem,"contextmenu.contextMenu":x.abortevent,"mouseenter.contextMenu":x.itemMouseenter,"mouseleave.contextMenu":x.itemMouseleave},".context-menu-item"),c=!0),s.on("contextmenu"+o.ns,o.selector,o,x.contextmenu),o.trigger){case"hover":s.on("mouseenter"+o.ns,o.selector,o,x.mouseenter).on("mouseleave"+o.ns,o.selector,o,x.mouseleave);break;case"left":s.on("click"+o.ns,o.selector,o,x.click)}"hover"!=o.trigger&&o.ignoreRightClick&&s.on("mousedown"+o.ns,o.selector,x.ignoreRightClick),o.build||g.create(o);break;case"destroy":if(o.selector){if(u[o.selector]){try{d[u[o.selector]].$menu&&d[u[o.selector]].$menu.remove(),delete d[u[o.selector]]}catch(e){d[u[o.selector]]=null}s.off(u[o.selector])}}else s.off(".contextMenu .contextMenuAutoHide"),e.each(u,function(e,t){s.off(t)}),u={},d={},r=0,c=!1,e(".context-menu-list").remove();break;case"html5":(!e.support.htmlCommand&&!e.support.htmlMenuitem||"boolean"==typeof a&&a)&&e('menu[type="context"]').each(function(){this.id&&e.contextMenu({selector:"[contextmenu="+this.id+"]",items:e.contextMenu.fromMenu(this)})}).css("display","none");break;default:throw new Error('Unknown operation "'+n+'"')}return this},e.contextMenu.setInputValues=function(n,a){a===t&&(a={}),e.each(n.inputs,function(e,t){switch(t.type){case"text":case"textarea":t.value=a[e]||"";break;case"checkbox":t.selected=!!a[e];break;case"radio":t.selected=(a[t.radio]||"")==t.value;break;case"select":t.selected=a[e]||""}})},e.contextMenu.getInputValues=function(n,a){return a===t&&(a={}),e.each(n.inputs,function(e,t){switch(t.type){case"text":case"textarea":case"select":a[e]=t.$input.val();break;case"checkbox":a[e]=t.$input.prop("checked");break;case"radio":t.$input.prop("checked")&&(a[t.radio]=t.value)}}),a},e.contextMenu.fromMenu=function(t){var n={};return o(n,e(t).children()),n},e.contextMenu.defaults=p,e.contextMenu.types=m}(jQuery);